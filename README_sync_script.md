# è¡¨æ ¼åŒæ­¥ Shell Script ä½¿ç”¨èªªæ˜

## æ¦‚è¿°
`sync_tables.sh` æ˜¯ä¸€å€‹è‡ªå‹•è¡¨æ ¼åŒæ­¥è…³æœ¬ï¼Œå®ƒæœƒè®€å– `config.yaml` ä¸­çš„é…ç½®ï¼Œä¸¦æ ¹æ“šå„è¡¨æ ¼çš„åŒæ­¥é–“éš”è‡ªå‹•åŸ·è¡ŒåŒæ­¥æ“ä½œã€‚

## åŠŸèƒ½ç‰¹é»
- ğŸ“‹ **è‡ªå‹•è®€å–é…ç½®**ï¼šå¾ `config.yaml` è®€å–åœ˜éšŠå’Œè¡¨æ ¼é…ç½®
- â° **æ™ºèƒ½æ’ç¨‹**ï¼šæ ¹æ“šå„è¡¨æ ¼çš„ `sync_interval` è¨­å®šè‡ªå‹•æ’ç¨‹
- ğŸ“ **è©³ç´°æ—¥èªŒ**ï¼šè¨˜éŒ„æ‰€æœ‰åŒæ­¥æ´»å‹•åˆ° `sync_tables.log`
- ğŸ”„ **æŒçºŒé‹è¡Œ**ï¼šé daemon æ¨¡å¼ï¼Œå¯åœ¨å‰å°é‹è¡Œä¸¦è§€å¯Ÿ
- ğŸ›‘ **å„ªé›…åœæ­¢**ï¼šæ”¯æ´ Ctrl+C å’Œ SIGTERM ä¿¡è™Ÿ

## ä½¿ç”¨æ–¹æ³•

### 1. ç¢ºä¿è…³æœ¬æœ‰åŸ·è¡Œæ¬Šé™
```bash
chmod +x sync_tables.sh
```

### 2. ç›´æ¥é‹è¡Œ
```bash
./sync_tables.sh
```

### 3. èƒŒæ™¯é‹è¡Œ
```bash
./sync_tables.sh &
```

### 4. ä½¿ç”¨ nohup é‹è¡Œï¼ˆå³ä½¿çµ‚ç«¯é—œé–‰ä¹Ÿæœƒç¹¼çºŒï¼‰
```bash
nohup ./sync_tables.sh > sync_output.log 2>&1 &
```

## é…ç½®èªªæ˜

è…³æœ¬æœƒè‡ªå‹•è®€å– `config.yaml` ä¸­çš„ä»¥ä¸‹é…ç½®ï¼š

### å…¨åŸŸè¨­å®š
```yaml
global:
  default_sync_interval: 180  # é è¨­åŒæ­¥é–“éš”ï¼ˆç§’ï¼‰
```

### åœ˜éšŠè¨­å®š
```yaml
teams:
  management:
    enabled: true
    sync_interval: 600  # åœ˜éšŠç´šåŒæ­¥é–“éš”
    tables:
      tp_table:
        enabled: true
        sync_interval: 600  # è¡¨æ ¼ç´šåŒæ­¥é–“éš”ï¼ˆæœƒè¦†è“‹åœ˜éšŠç´šè¨­å®šï¼‰
```

## åŒæ­¥é–“éš”å„ªå…ˆç´š
1. **è¡¨æ ¼ç´š sync_interval**ï¼ˆæœ€é«˜å„ªå…ˆç´šï¼‰
2. **åœ˜éšŠç´š sync_interval**
3. **å…¨åŸŸ default_sync_interval**ï¼ˆæœ€ä½å„ªå…ˆç´šï¼‰

## æ—¥èªŒæª”æ¡ˆ
- **ä¸»æ—¥èªŒ**ï¼š`sync_tables.log` - è…³æœ¬é‹è¡Œæ—¥èªŒ
- **åŒæ­¥æ—¥èªŒ**ï¼š`jira_lark_sync.log` - Python ç¨‹å¼çš„è©³ç´°åŒæ­¥æ—¥èªŒ

## è¼¸å‡ºç¯„ä¾‹
```
[2025-07-10 17:00:00] ğŸš€ é–‹å§‹è¡¨æ ¼åŒæ­¥æ’ç¨‹å™¨
[2025-07-10 17:00:00] ç›£æ§ 6 å€‹è¡¨æ ¼
[2025-07-10 17:00:00] ğŸ”„ é–‹å§‹åŒæ­¥è¡¨æ ¼: management.tp_table
[2025-07-10 17:00:15] âœ… è¡¨æ ¼ management.tp_table åŒæ­¥æˆåŠŸ
[2025-07-10 17:00:15] ğŸ“… è¡¨æ ¼ management.tp_table ä¸‹æ¬¡åŒæ­¥æ™‚é–“: 17:10:15
[2025-07-10 17:00:15] ğŸ“Š ä¸‹æ¬¡åŒæ­¥æ™‚é–“è¡¨:
[2025-07-10 17:00:15]   management.tp_table: 17:10:15 (é–“éš”: 600s)
[2025-07-10 17:00:15]   management.tcg_table: 17:00:00 (é–“éš”: 600s)
[2025-07-10 17:00:15]   management.icr_table: 17:00:00 (é–“éš”: 600s)
[2025-07-10 17:00:15]   aid_trm.aid_table: 17:00:00 (é–“éš”: 180s)
[2025-07-10 17:00:15]   aid_trm.trm_table: 17:00:00 (é–“éš”: 180s)
[2025-07-10 17:00:15]   wsd.wsd_table: 17:00:00 (é–“éš”: 180s)
```

## åœæ­¢è…³æœ¬
- **å‰å°é‹è¡Œ**ï¼šæŒ‰ `Ctrl+C`
- **èƒŒæ™¯é‹è¡Œ**ï¼šä½¿ç”¨ `kill` å‘½ä»¤æˆ– `killall sync_tables.sh`

## æ•…éšœæ’é™¤

### 1. æ¬Šé™å•é¡Œ
```bash
chmod +x sync_tables.sh
```

### 2. Python ç’°å¢ƒå•é¡Œ
ç¢ºä¿ Python 3 å·²å®‰è£ï¼Œä¸” `main.py` å¯æ­£å¸¸åŸ·è¡Œï¼š
```bash
python3 main.py sync --team management --table tp_table
```

### 3. é…ç½®æª”æ¡ˆå•é¡Œ
æª¢æŸ¥ `config.yaml` æ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¢ºï¼š
```bash
python3 -c "import yaml; yaml.safe_load(open('config.yaml'))"
```

### 4. æª¢æŸ¥æ—¥èªŒ
```bash
tail -f sync_tables.log
tail -f jira_lark_sync.log
```

## å„ªé»
- âœ… **è¼•é‡ç´š**ï¼šä¸ä¾è³´é¡å¤–çš„æ’ç¨‹ç³»çµ±
- âœ… **å¯è§€æ¸¬**ï¼šå¯¦æ™‚è¼¸å‡ºå’Œè©³ç´°æ—¥èªŒ
- âœ… **éˆæ´»æ€§**ï¼šå¯è¼•æ˜“ä¿®æ”¹å’Œå®¢è£½åŒ–
- âœ… **å¯æ§æ€§**ï¼šå¯éš¨æ™‚åœæ­¢å’Œé‡å•Ÿ
- âœ… **èˆ‡ç¾æœ‰ç³»çµ±æ•´åˆ**ï¼šä½¿ç”¨ç¾æœ‰çš„ Python åŒæ­¥ç¨‹å¼