# JIRA-Lark 同步系統 Web 介面

> 🌐 基於 Flask 的現代化管理介面，專注於配置管理和系統工具

## 🚀 快速開始

### 啟動 Web 介面

```bash
# 方法 1: 使用啟動腳本（推薦）
python run_web.py

# 方法 2: 直接啟動
python web_app.py
```

訪問 http://localhost:8888 查看 Web 介面

## 📋 功能特色

### 1. 系統概覽
- **系統狀態監控**: 即時顯示各組件狀態
- **統計資訊**: 團隊數、表格數、同步狀態等
- **快速操作**: 一鍵跳轉到各功能模組
- **最近活動**: 顯示系統最新操作記錄

### 2. 團隊配置管理
- **可視化配置**: 圖形化編輯團隊同步設定
- **批次管理**: 支援多表格配置
- **即時驗證**: 配置修改時自動驗證格式
- **保留註解**: 修改 YAML 時保留原有註解和格式

### 3. 日誌查看
- **實時日誌**: 自動刷新最新日誌內容
- **智能篩選**: 按級別、檔案、關鍵字篩選
- **彩色顯示**: 不同級別的日誌使用不同顏色
- **統計分析**: 顯示各級別日誌的數量統計

### 4. 用戶映射管理
- **映射編輯**: 視覺化管理 JIRA ↔ Lark 用戶對應
- **批次操作**: 支援批次新增、編輯、驗證
- **狀態管理**: 區分已驗證、未驗證、不完整狀態
- **資料匯出**: 支援 CSV 格式匯出

### 5. 系統工具
- **重複記錄檢測**: 自動檢測並清理重複資料
- **快取管理**: 清理各種系統快取
- **配置備份**: 備份和還原系統配置
- **系統診斷**: 檢測 JIRA、Lark 連接狀態

## 🎨 設計特色

### Gmail 風格佈局
- **左側固定導覽**: 仿 Gmail 的側邊欄設計
- **響應式佈局**: 自適應各種螢幕尺寸
- **專業配色**: 柔和的藍色主題配色

### 安全特性
- **文件鎖定**: 防止多人同時編輯配置
- **格式保留**: 使用 ruamel.yaml 保留 YAML 註解
- **操作記錄**: 記錄所有重要操作到日誌

## 📁 檔案結構

```
web-interface/
├── web_app.py              # Flask 主應用
├── run_web.py              # 啟動腳本
├── templates/              # Jinja2 模板
│   ├── base.html          # 基礎模板
│   ├── index.html         # 系統概覽
│   ├── teams.html         # 團隊配置
│   ├── logs.html          # 日誌查看
│   ├── user_mapping.html  # 用戶映射
│   └── tools.html         # 系統工具
└── static/
    └── css/
        └── style.css       # 樣式檔案
```

## 🔧 技術架構

### 後端技術
- **Flask**: 輕量級 Web 框架
- **ruamel.yaml**: 保留格式的 YAML 處理
- **threading**: 多人操作防衝突

### 前端技術
- **Bootstrap 5**: 現代化 UI 框架
- **Font Awesome**: 圖示庫
- **原生 JavaScript**: 不依賴外部 JS 框架

### 現有系統整合
- **ConfigManager**: 配置管理
- **UserMapper**: 用戶映射
- **Logger**: 日誌系統

## ⚙️ 配置說明

### 環境需求
- Python 3.8+
- Flask >= 2.3.0
- ruamel.yaml >= 0.18.0
- 現有的 JIRA-Lark 同步系統模組

### 配置檔案
Web 介面會自動讀取現有的 `config.yaml`，無需額外配置。

## 🚀 使用指南

### 1. 團隊配置管理

**新增團隊**:
1. 點擊「新增團隊」按鈕
2. 填寫團隊名稱（唯一識別符）
3. 設定 JQL 篩選器
4. 配置同步間隔
5. 新增一個或多個表格配置

**編輯團隊**:
1. 點擊團隊列表中的編輯按鈕
2. 修改相關設定
3. 點擊「更新」保存

### 2. 用戶映射管理

**新增映射**:
1. 點擊「新增映射」按鈕
2. 填寫 JIRA 用戶名和 Lark 用戶 ID
3. 可選填寫顯示名稱
4. 點擊「保存」

**批次操作**:
- 使用搜尋和篩選功能快速定位
- 支援按狀態（已驗證、未驗證、不完整）篩選
- 可匯出 CSV 格式進行批次處理

### 3. 重複記錄檢測

**檢測流程**:
1. 選擇要檢測的團隊和表格
2. 點擊「檢測重複記錄」
3. 查看檢測結果
4. 選擇要刪除的重複記錄
5. 點擊「刪除選中記錄」

## 🔒 安全注意事項

1. **多人編輯保護**: 系統使用文件鎖防止同時編輯配置
2. **格式保留**: 修改 YAML 時保留原有註解和格式
3. **操作記錄**: 所有重要操作都會記錄到日誌
4. **權限控制**: 建議在內網環境中使用

## 🐛 故障排除

### 常見問題

**1. 模組導入失敗**
```bash
# 確保在正確的目錄下啟動
cd /path/to/jira_sync_v3
python run_web.py
```

**2. 配置檔案無法載入**
- 檢查 `config.yaml` 是否存在
- 檢查 YAML 格式是否正確
- 查看 `web_app.log` 了解詳細錯誤

**3. 用戶映射功能異常**
- 檢查 `data/user_mapping_cache.db` 是否可寫
- 確保資料庫檔案權限正確

### 日誌檔案
- `web_app.log`: Web 介面運行日誌
- `jira_lark_sync.log`: 主系統日誌

## 📈 未來規劃

### 即將推出
- [ ] 實時同步狀態監控
- [ ] 配置檔案版本控制
- [ ] 更多系統診斷工具
- [ ] API 文檔生成

### 長期計劃
- [ ] 多用戶權限管理
- [ ] 同步任務排程器
- [ ] 效能監控儀表板
- [ ] 移動端適配

## 📞 技術支援

如遇問題，請檢查：
1. 系統日誌 (`web_app.log`)
2. 主系統日誌 (`jira_lark_sync.log`)
3. 控制台輸出

---

**🤖 由 Claude 設計開發 - 現代化的 JIRA-Lark 同步系統管理介面**